IDENTIFICATION DIVISION.
    PROGRAM-ID. IDEONE.
ENVIRONMENT DIVISION.
DATA DIVISION.
WORKING-STORAGE SECTION.
    01 INPUT-TEXT           PIC X(50) VALUE SPACES.
    01 OUTPUT-TEXT          PIC X(50) VALUE SPACES.
    01 SHIFT-AMOUNT         PIC S99.
    01 MAX-SHIFT            PIC 99.
    01 COUNTERS.
        05 TEXT-LENGTH      PIC 99 VALUE 0.
        05 CHAR-POS         PIC 99 VALUE 1.
    01 WORK-AREAS.
        05 CURRENT-CHAR     PIC X.
        05 ASCII-VAL        PIC 999.
        05 SHIFTED-VAL      PIC 999.
        05 SOLVE-COUNT      PIC 999.
    01 DISPLAY-FORMAT.
        05 FILLER           PIC X(7) VALUE 'Cipher '.
        05 SHIFT-NUM        PIC Z9.
        05 FILLER           PIC X(2) VALUE ': '.
        05 CIPHER-TEXT      PIC X(50).

PROCEDURE DIVISION.
ENCRYPT-TEXT.
    MOVE 0 TO TEXT-LENGTH
    MOVE SPACES TO OUTPUT-TEXT
    STRING INPUT-TEXT DELIMITED BY SIZE
           INTO OUTPUT-TEXT
    INSPECT INPUT-TEXT TALLYING TEXT-LENGTH 
        FOR CHARACTERS
    PERFORM VARYING CHAR-POS FROM 1 BY 1 
        UNTIL CHAR-POS > TEXT-LENGTH
        MOVE INPUT-TEXT(CHAR-POS:1) TO CURRENT-CHAR
        MOVE FUNCTION ORD(CURRENT-CHAR) TO ASCII-VAL
        IF (ASCII-VAL >= 65 AND ASCII-VAL <= 90)
            PERFORM PROCESS-CHAR
            MOVE CURRENT-CHAR TO OUTPUT-TEXT(CHAR-POS:1)
        ELSE IF (ASCII-VAL >= 97 AND ASCII-VAL <= 122)
            COMPUTE ASCII-VAL = ASCII-VAL - 32
            MOVE FUNCTION CHAR(ASCII-VAL) TO CURRENT-CHAR
            PERFORM PROCESS-CHAR
            MOVE CURRENT-CHAR TO OUTPUT-TEXT(CHAR-POS:1)
        ELSE
            MOVE CURRENT-CHAR TO OUTPUT-TEXT(CHAR-POS:1)
        END-IF
    END-PERFORM.
    EXIT.

DECRYPT-TEXT.
    MULTIPLY SHIFT-AMOUNT BY -1 GIVING SHIFT-AMOUNT
    PERFORM ENCRYPT-TEXT
    MULTIPLY SHIFT-AMOUNT BY -1 GIVING SHIFT-AMOUNT.
    EXIT.

SOLVE-CIPHER.
    PERFORM VARYING SOLVE-COUNT FROM 1 BY 1
        UNTIL SOLVE-COUNT > MAX-SHIFT
        MOVE SOLVE-COUNT TO SHIFT-AMOUNT
        MOVE SOLVE-COUNT TO SHIFT-NUM
        MOVE SPACES TO OUTPUT-TEXT
        PERFORM ENCRYPT-TEXT
        MOVE OUTPUT-TEXT TO CIPHER-TEXT
        DISPLAY DISPLAY-FORMAT
    END-PERFORM.
    EXIT.

PROCESS-CHAR.
    COMPUTE SHIFTED-VAL = ASCII-VAL - 65
    ADD SHIFT-AMOUNT TO SHIFTED-VAL
    ADD 26 TO SHIFTED-VAL
    DIVIDE SHIFTED-VAL BY 26 GIVING SHIFTED-VAL REMAINDER SHIFTED-VAL
    ADD 65 TO SHIFTED-VAL
    MOVE FUNCTION CHAR(SHIFTED-VAL) TO CURRENT-CHAR.
    EXIT.

MAIN-PROCEDURE.
    MOVE "OPERATION DAYBREAK" TO INPUT-TEXT
    MOVE 2 TO SHIFT-AMOUNT
    PERFORM ENCRYPT-TEXT
    DISPLAY "Encrypted: " OUTPUT-TEXT
    MOVE OUTPUT-TEXT TO INPUT-TEXT
    PERFORM DECRYPT-TEXT
    DISPLAY "Decrypted: " OUTPUT-TEXT
    
    MOVE "HAL" TO INPUT-TEXT
    MOVE SPACES TO OUTPUT-TEXT
    MOVE 26 TO MAX-SHIFT
    PERFORM SOLVE-CIPHER.
    STOP RUN.